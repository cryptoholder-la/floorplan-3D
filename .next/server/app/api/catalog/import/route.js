"use strict";(()=>{var t={};t.id=942,t.ids=[942],t.modules={399:t=>{t.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:t=>{t.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},2048:t=>{t.exports=require("fs")},5315:t=>{t.exports=require("path")},5877:(t,e,a)=>{a.r(e),a.d(e,{originalPathname:()=>v,patchFetch:()=>A,requestAsyncStorage:()=>h,routeModule:()=>f,serverHooks:()=>S,staticGenerationAsyncStorage:()=>w});var r={};a.r(r);var i={};a.r(i),a.d(i,{POST:()=>g,runtime:()=>c});var n=a(9303),o=a(8716),s=a(670),p=a(7070),l=a(2048);async function u(t){var e;let a=await l.promises.stat(t.relativePath);return{id:t.id,fileName:t.fileName,relativePath:t.relativePath,mimeType:(e=t.fileName,({jpg:"image/jpeg",jpeg:"image/jpeg",png:"image/png",gif:"image/gif",pdf:"application/pdf",dwg:"application/acad",dxf:"application/dxf",json:"application/json",csv:"text/csv",txt:"text/plain"})[e.split(".").pop()?.toLowerCase()||""]||"application/octet-stream"),size:a.size,createdAt:new Date().toISOString()}}async function d(t){let e=t.split("\n").filter(t=>t.trim()),a=[];for(let t of e){let e=[],r="",i=!1;for(let a=0;a<t.length;a++){let n=t[a];'"'===n?i=!i:","!==n||i?r+=n:(e.push(r.trim()),r="")}e.push(r.trim()),a.push(e)}return a}a(5315);let c="nodejs";function m(t){return t.sku?`sku:${t.sku}`:t.id}async function g(t){try{let a=(await t.formData()).getAll("files").filter(t=>t instanceof File);if(0===a.length)return new p.NextResponse('No files uploaded (field name should be "files")',{status:400});let i=await (0,r.readCatalogFile)(),n=[],o=[];for(let t of a){let a=(t.name.split(".").pop()||"").toLowerCase();if("csv"===a){let e=await t.text(),a=d(e);n.push(...a.map((t,e)=>({id:`csv-${e}`,sku:t[0]||"",name:t[1]||"",description:t[2]||"",category:t[3]||"Uncategorized",cost:parseFloat(t[4])||0,qty:parseInt(t[5])||1,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()})));continue}if("json"===a){var e;let a=await t.text(),r=(e=JSON.parse(a),Array.isArray(e)?e.map((t,e)=>({id:t.id||`json-${e}`,sku:t.sku||"",name:t.name||"",description:t.description||"",category:t.category||"Uncategorized",cost:parseFloat(t.cost)||0,qty:parseInt(t.qty)||1,createdAt:t.createdAt||new Date().toISOString(),updatedAt:t.updatedAt||new Date().toISOString()})):[]);r.forEach(t=>{t.sku=t.sku||p,t.name=t.name||s}),n.push(...r);continue}let i=new Uint8Array(await t.arrayBuffer()),s=t.name.replace(/\.[^/.]+$/,""),p=s.split(/[_\-\s]+/)[0]?.toUpperCase(),l={id:p?`sku:${p}`:`name:${s.toLowerCase()}`,sku:p||void 0,name:s,qty:0,cost:0,category:"Catalog",parts:[],attachments:[],createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};n.push(l);let c=m(l),g=await (0,r.writeAttachment)({itemKey:c,fileName:t.name,bytes:i}),f=u({id:`att:${Date.now()}:${Math.random().toString(16).slice(2)}`,fileName:t.name,relativePath:g.relativePath});o.push({itemKey:c,attachment:f})}let s=function(t,e){let a=new Map(t.map(t=>[t.id,t])),r=new Map(e.map(t=>[t.id,t])),i=0,n=0,o=0,s=[];for(let[t,e]of r)a.has(t)?o++:(s.push({...e,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}),i++);for(let[t,e]of a){let a=r.get(t);a?(s.push({...e,...a,updatedAt:new Date().toISOString()}),n++):s.push(e)}return{items:s,created:new Date().toISOString(),updated:new Date().toISOString(),added:i,updatedCount:n,duplicates:o}}(i.items,n);if(o.length){let t=s.items.map(t=>{let e=m(t),a=o.filter(t=>t.itemKey===e).map(t=>t.attachment);return a.length?{...t,attachments:[...t.attachments||[],...a],updatedAt:new Date().toISOString()}:t});s.items=t}return await (0,r.writeCatalogFile)({items:s.items}),p.NextResponse.json({items:s.items,created:s.created,updated:s.updated})}catch(t){return new p.NextResponse(t?.message||"Import failed",{status:500})}}let f=new n.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/catalog/import/route",pathname:"/api/catalog/import",filename:"route",bundlePath:"app/api/catalog/import/route"},resolvedPagePath:"C:\\memlayer-main\\floorplan 3D\\src\\app\\api\\catalog\\import\\route.ts",nextConfigOutput:"",userland:i}),{requestAsyncStorage:h,staticGenerationAsyncStorage:w,serverHooks:S}=f,v="/api/catalog/import/route";function A(){return(0,s.patchFetch)({serverHooks:S,staticGenerationAsyncStorage:w})}}};var e=require("../../../../webpack-runtime.js");e.C(t);var a=t=>e(e.s=t),r=e.X(0,[276,972],()=>a(5877));module.exports=r})();