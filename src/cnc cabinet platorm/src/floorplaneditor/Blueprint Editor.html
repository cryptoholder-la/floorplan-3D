
<!DOCTYPE html>
<html class="dark" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>3D Blueprint Editor</title>
<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
<link href="https://fonts.googleapis.com" rel="preconnect"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300..700&display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet"/>
<link rel="stylesheet" href="style.css">
<style>
.material-symbols-outlined {
    font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24;
}

#viewport-container {
    width: 100%;
    height: 100%;
    position: relative;
    display: flex;
}

#blueprint-view {
    flex: 1;
    position: relative;
    background: #f0f0f0;
}

#blueprint-canvas {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
}

#panorama-3d-view {
    flex: 1;
    position: relative;
}

#cv, #render-3d-view {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
}

#render-3d-view {
    display: none;
}

#render-3d-view.active {
    display: block;
}

.tooltip {
    position: absolute;
    background: rgba(0, 0, 0, 0.8);
    color: white;
    padding: 8px 12px;
    border-radius: 6px;
    font-size: 12px;
    pointer-events: none;
    z-index: 1000;
    display: none;
}

.tooltip.active {
    display: block;
}

.item-category {
    margin-bottom: 16px;
}

.item-category-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 8px 0;
    cursor: pointer;
    user-select: none;
}

.item-category-content {
    max-height: 500px;
    overflow: hidden;
    transition: max-height 0.3s ease;
}

.item-category-content.collapsed {
    max-height: 0;
}
</style>
<script id="tailwind-config">
tailwind.config = {
    darkMode: "class",
    theme: {
        extend: {
            colors: {
                "primary": "#13a4ec",
                "background-light": "#f6f7f8",
                "background-dark": "#101c22",
            },
            fontFamily: {
                "display": ["Space Grotesk", "sans-serif"]
            },
            borderRadius: {
                "DEFAULT": "0.25rem",
                "lg": "0.5rem",
                "xl": "0.75rem",
                "full": "9999px"
            },
        },
    },
}
</script>
</head>
<body class="font-display bg-background-light dark:bg-background-dark text-gray-800 dark:text-gray-200 overflow-hidden">
<div class="relative flex min-h-screen w-full flex-col">
<header class="sticky top-0 z-50 bg-background-light/80 dark:bg-background-dark/80 backdrop-blur-sm">
<nav class="container mx-auto flex items-center justify-between whitespace-nowrap border-b border-gray-200 dark:border-gray-800 px-6 py-4">
<div class="flex items-center gap-4 text-gray-900 dark:text-white">
<span class="material-symbols-outlined text-primary text-3xl">view_in_ar</span>
<h2 class="text-xl font-bold tracking-[-0.015em]">Blueprint Editor</h2>
</div>
<div class="hidden md:flex flex-1 justify-center items-center gap-6">
<div class="flex items-center gap-1 rounded-lg bg-gray-200 dark:bg-gray-800 p-1">
<button onclick="window.undo()" aria-label="Undo" class="flex h-8 w-8 items-center justify-center rounded-md text-gray-500 dark:text-gray-400 hover:bg-gray-300 dark:hover:bg-gray-700 hover:text-gray-800 dark:hover:text-gray-200 transition-colors" title="Undo (Ctrl+Z)">
<span class="material-symbols-outlined text-xl">undo</span>
</button>
<button onclick="window.redo()" aria-label="Redo" class="flex h-8 w-8 items-center justify-center rounded-md text-gray-500 dark:text-gray-400 hover:bg-gray-300 dark:hover:bg-gray-700 hover:text-gray-800 dark:hover:text-gray-200 transition-colors" title="Redo (Ctrl+Shift+Z)">
<span class="material-symbols-outlined text-xl">redo</span>
</button>
</div>
<div class="flex items-center gap-4">
<span class="text-sm font-medium text-gray-500 dark:text-gray-400">Panorama</span>
<label class="relative inline-flex cursor-pointer items-center">
<input class="peer sr-only" type="checkbox" id="view-toggle"/>
<div class="peer h-6 w-11 rounded-full bg-gray-200 after:absolute after:start-[2px] after:top-[2px] after:h-5 after:w-5 after:rounded-full after:border after:border-gray-300 after:bg-white after:transition-all after:content-[''] peer-checked:bg-primary peer-checked:after:translate-x-full peer-checked:after:border-white dark:border-gray-600 dark:bg-gray-700"></div>
</label>
<span class="text-sm font-medium text-gray-500 dark:text-gray-400">3D</span>
</div>

<button id="walk-btn" class="hidden ml-2 items-center justify-center rounded-lg h-8 px-3 bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 text-gray-700 dark:text-white transition-colors text-xs font-bold uppercase tracking-wider gap-1">
    <span class="material-symbols-outlined text-sm">directions_walk</span>
    Walk
</button>

<div class="flex items-center gap-2 border-l border-gray-300 dark:border-gray-700 pl-4">
    <!-- Story Controls -->
    <div class="flex items-center gap-2 mr-2">
        <select id="story-select" onchange="window.switchStory(this.value)" class="h-8 text-xs rounded border-gray-300 bg-gray-50 dark:bg-gray-800 dark:border-gray-600">
            <option value="0">Ground Floor</option>
        </select>
        <button onclick="window.addStory()" class="h-8 w-8 flex items-center justify-center rounded bg-primary text-white hover:bg-primary/90" title="Add Floor">
            <span class="material-symbols-outlined text-sm">add</span>
        </button>
    </div>
    
    <label class="flex items-center gap-2 cursor-pointer select-none" title="Toggle Dimensions">
        <div class="relative">
            <input type="checkbox" class="sr-only peer" checked onchange="window.toggleDimensions()">
            <div class="w-9 h-5 bg-gray-200 peer-focus:outline-none rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all dark:border-gray-600 peer-checked:bg-primary"></div>
        </div>
        <span class="text-sm font-medium text-gray-500 dark:text-gray-400">Dims</span>
    </label>
    <label class="flex items-center gap-2 cursor-pointer select-none" title="Toggle Ceiling">
        <div class="relative">
            <input type="checkbox" id="ceiling-toggle" class="sr-only peer" onchange="window.toggleCeiling()">
            <div class="w-9 h-5 bg-gray-200 peer-focus:outline-none rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all dark:border-gray-600 peer-checked:bg-primary"></div>
        </div>
        <span class="text-sm font-medium text-gray-500 dark:text-gray-400">Ceiling</span>
    </label>
    <label class="flex items-center gap-2 cursor-pointer select-none" title="Toggle Roof">
        <div class="relative">
            <input type="checkbox" id="roof-toggle" class="sr-only peer" onchange="window.toggleRoof()">
            <div class="w-9 h-5 bg-gray-200 peer-focus:outline-none rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all dark:border-gray-600 peer-checked:bg-primary"></div>
        </div>
        <span class="text-sm font-medium text-gray-500 dark:text-gray-400">Roof</span>
    </label>
</div>
<div class="flex gap-2">
<button onclick="window.location.href='index.html'" class="flex min-w-[84px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-10 px-4 text-gray-800 dark:text-white text-sm font-bold tracking-[0.015em] hover:bg-gray-200 dark:hover:bg-gray-800 transition-colors gap-2">
<span class="material-symbols-outlined text-base">arrow_back</span>
<span class="truncate">Back to Home</span>
</button>
</div>
</nav>
</header>
<main class="flex h-full grow overflow-hidden">
<aside class="w-64 flex-shrink-0 border-r border-gray-200 dark:border-gray-800 bg-white dark:bg-background-dark/50 p-4 flex flex-col gap-4 overflow-y-auto">
<!-- File Upload Section -->
<div class="item-category">
    <div class="item-category-header">
        <h3 class="text-lg font-bold text-gray-900 dark:text-white">Import/Export</h3>
    </div>
    <div class="space-y-2 mt-2">
        <button onclick="document.getElementById('file-upload').click()" class="w-full flex items-center justify-center gap-2 p-3 rounded-lg border border-gray-200 dark:border-gray-700 bg-background-light dark:bg-gray-800 cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors">
            <span class="material-symbols-outlined text-primary">upload_file</span>
            <span class="font-medium text-sm">Import File</span>
        </button>
        <input type="file" id="file-upload" accept="image/*,.pdf,.json" style="display: none;">
        <button onclick="document.getElementById('kitchen-photo-upload').click()" class="w-full flex items-center justify-center gap-2 p-3 rounded-lg border border-gray-200 dark:border-gray-700 bg-primary/10 dark:bg-primary/20 cursor-pointer hover:bg-primary/20 dark:hover:bg-primary/30 transition-colors">
            <span class="material-symbols-outlined text-primary">photo_camera</span>
            <span class="font-medium text-sm text-primary">Scan Kitchen Photo</span>
        </button>
        <input type="file" id="kitchen-photo-upload" accept="image/*" style="display: none;">
        <button onclick="exportProject()" class="w-full flex items-center justify-center gap-2 p-3 rounded-lg border border-gray-200 dark:border-gray-700 bg-background-light dark:bg-gray-800 cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors">
            <span class="material-symbols-outlined text-primary">download</span>
            <span class="font-medium text-sm">Export Project JSON</span>
        </button>
        <div class="grid grid-cols-2 gap-2">
            <button onclick="window.export3D('obj')" class="flex items-center justify-center gap-2 p-3 rounded-lg border border-gray-200 dark:border-gray-700 bg-background-light dark:bg-gray-800 cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors">
                <span class="font-medium text-sm">Export OBJ</span>
            </button>
            <button onclick="window.export3D('gltf')" class="flex items-center justify-center gap-2 p-3 rounded-lg border border-gray-200 dark:border-gray-700 bg-background-light dark:bg-gray-800 cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors">
                <span class="font-medium text-sm">Export GLTF</span>
            </button>
        </div>
    </div>
</div>

<h3 class="text-lg font-bold text-gray-900 dark:text-white">Drawing Tools</h3>
<ul class="space-y-2">
<li class="item-button flex items-center justify-between gap-2 p-3 rounded-lg border border-gray-200 dark:border-gray-700 bg-background-light dark:bg-gray-800 cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors" data-item="wall" title="Draw walls by clicking start and end points">
<div class="flex items-center gap-3">
<span class="material-symbols-outlined text-gray-500 dark:text-gray-400">line_axis</span>
<span class="font-medium text-sm">Wall</span>
</div>
<span class="material-symbols-outlined text-primary">add</span>
</li>

<!-- Added Structural Items -->
<li class="item-button flex items-center justify-between gap-2 p-3 rounded-lg border border-gray-200 dark:border-gray-700 bg-background-light dark:bg-gray-800 cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors" data-item="door" title="Place a door">
<div class="flex items-center gap-3">
<span class="material-symbols-outlined text-gray-500 dark:text-gray-400">door_front</span>
<span class="font-medium text-sm">Door</span>
</div>
<span class="material-symbols-outlined text-primary">add</span>
</li>
<li class="item-button flex items-center justify-between gap-2 p-3 rounded-lg border border-gray-200 dark:border-gray-700 bg-background-light dark:bg-gray-800 cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors" data-item="window" title="Place a window">
<div class="flex items-center gap-3">
<span class="material-symbols-outlined text-gray-500 dark:text-gray-400">window</span>
<span class="font-medium text-sm">Window</span>
</div>
<span class="material-symbols-outlined text-primary">add</span>
</li>
<li class="item-button flex items-center justify-between gap-2 p-3 rounded-lg border border-gray-200 dark:border-gray-700 bg-background-light dark:bg-gray-800 cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors" data-item="round_window" title="Place a round window">
<div class="flex items-center gap-3">
<span class="material-symbols-outlined text-gray-500 dark:text-gray-400">circle</span>
<span class="font-medium text-sm">Round Window</span>
</div>
<span class="material-symbols-outlined text-primary">add</span>
</li>
</ul>

<!-- Bathroom Items Category -->
<div class="item-category">
    <div class="item-category-header" onclick="toggleCategory('bathroom-items')">
        <h3 class="text-lg font-bold text-gray-900 dark:text-white">Bathroom Items</h3>
        <span class="material-symbols-outlined transition-transform" id="bathroom-items-icon">expand_more</span>
    </div>
    <div class="item-category-content" id="bathroom-items">
        <ul class="space-y-2 mt-2">
            <li class="item-button flex items-center justify-between gap-2 p-3 rounded-lg border border-gray-200 dark:border-gray-700 bg-background-light dark:bg-gray-800 cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors" data-item="bathtub" title="Place a bathtub fixture">
                <div class="flex items-center gap-3">
                    <span class="material-symbols-outlined text-gray-500 dark:text-gray-400">bathtub</span>
                    <span class="font-medium text-sm">Bathtub</span>
                </div>
                <span class="material-symbols-outlined text-primary">add</span>
            </li>
            <li class="item-button flex items-center justify-between gap-2 p-3 rounded-lg border border-gray-200 dark:border-gray-700 bg-background-light dark:bg-gray-800 cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors" data-item="toilet" title="Place a toilet fixture">
                <div class="flex items-center gap-3">
                    <span class="material-symbols-outlined text-gray-500 dark:text-gray-400">wc</span>
                    <span class="font-medium text-sm">Toilet</span>
                </div>
                <span class="material-symbols-outlined text-primary">add</span>
            </li>
            <li class="item-button flex items-center justify-between gap-2 p-3 rounded-lg border border-gray-200 dark:border-gray-700 bg-background-light dark:bg-gray-800 cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors" data-item="sink" title="Place a sink fixture">
                <div class="flex items-center gap-3">
                    <span class="material-symbols-outlined text-gray-500 dark:text-gray-400">bathroom</span>
                    <span class="font-medium text-sm">Sink</span>
                </div>
                <span class="material-symbols-outlined text-primary">add</span>
            </li>
            <li class="item-button flex items-center justify-between gap-2 p-3 rounded-lg border border-gray-200 dark:border-gray-700 bg-background-light dark:bg-gray-800 cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors" data-item="shower" title="Place a shower fixture">
                <div class="flex items-center gap-3">
                    <span class="material-symbols-outlined text-gray-500 dark:text-gray-400">shower</span>
                    <span class="font-medium text-sm">Shower</span>
                </div>
                <span class="material-symbols-outlined text-primary">add</span>
            </li>
        </ul>
    </div>
</div>

<!-- Kitchen Items Category -->
<div class="item-category">
    <div class="item-category-header" onclick="toggleCategory('kitchen-items')">
        <h3 class="text-lg font-bold text-gray-900 dark:text-white">Kitchen Items</h3>
        <span class="material-symbols-outlined transition-transform" id="kitchen-items-icon">expand_more</span>
    </div>
    <div class="item-category-content collapsed" id="kitchen-items">
        <ul class="space-y-2 mt-2">
            <li class="item-button flex items-center justify-between gap-2 p-3 rounded-lg border border-gray-200 dark:border-gray-700 bg-background-light dark:bg-gray-800 cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors" data-item="kitchen_cabinet">
                <div class="flex items-center gap-3">
                    <span class="material-symbols-outlined text-gray-500 dark:text-gray-400">kitchen</span>
                    <span class="font-medium text-sm">Cabinet</span>
                </div>
                <span class="material-symbols-outlined text-primary">add</span>
            </li>
            <li class="item-button flex items-center justify-between gap-2 p-3 rounded-lg border border-gray-200 dark:border-gray-700 bg-background-light dark:bg-gray-800 cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors" data-item="kitchen_sink">
                <div class="flex items-center gap-3">
                    <span class="material-symbols-outlined text-gray-500 dark:text-gray-400">water_drop</span>
                    <span class="font-medium text-sm">Sink Unit</span>
                </div>
                <span class="material-symbols-outlined text-primary">add</span>
            </li>
            <li class="item-button flex items-center justify-between gap-2 p-3 rounded-lg border border-gray-200 dark:border-gray-700 bg-background-light dark:bg-gray-800 cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors" data-item="stove">
                <div class="flex items-center gap-3">
                    <span class="material-symbols-outlined text-gray-500 dark:text-gray-400">oven_gen</span>
                    <span class="font-medium text-sm">Stove</span>
                </div>
                <span class="material-symbols-outlined text-primary">add</span>
            </li>
            <li class="item-button flex items-center justify-between gap-2 p-3 rounded-lg border border-gray-200 dark:border-gray-700 bg-background-light dark:bg-gray-800 cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors" data-item="fridge">
                <div class="flex items-center gap-3">
                    <span class="material-symbols-outlined text-gray-500 dark:text-gray-400">kitchen</span>
                    <span class="font-medium text-sm">Fridge</span>
                </div>
                <span class="material-symbols-outlined text-primary">add</span>
            </li>
             <li class="item-button flex items-center justify-between gap-2 p-3 rounded-lg border border-gray-200 dark:border-gray-700 bg-background-light dark:bg-gray-800 cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors" data-item="kitchen_island">
                <div class="flex items-center gap-3">
                    <span class="material-symbols-outlined text-gray-500 dark:text-gray-400">countertops</span>
                    <span class="font-medium text-sm">Island</span>
                </div>
                <span class="material-symbols-outlined text-primary">add</span>
            </li>
        </ul>
    </div>
</div>

<!-- Living Room Items Category -->
<div class="item-category">
    <div class="item-category-header" onclick="toggleCategory('living-items')">
        <h3 class="text-lg font-bold text-gray-900 dark:text-white">Living Room</h3>
        <span class="material-symbols-outlined transition-transform" id="living-items-icon">expand_more</span>
    </div>
    <div class="item-category-content collapsed" id="living-items">
        <ul class="space-y-2 mt-2">
            <li class="item-button flex items-center justify-between gap-2 p-3 rounded-lg border border-gray-200 dark:border-gray-700 bg-background-light dark:bg-gray-800 cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors" data-item="sofa">
                <div class="flex items-center gap-3">
                    <span class="material-symbols-outlined text-gray-500 dark:text-gray-400">chair</span>
                    <span class="font-medium text-sm">Sofa</span>
                </div>
                <span class="material-symbols-outlined text-primary">add</span>
            </li>
             <li class="item-button flex items-center justify-between gap-2 p-3 rounded-lg border border-gray-200 dark:border-gray-700 bg-background-light dark:bg-gray-800 cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors" data-item="armchair">
                <div class="flex items-center gap-3">
                    <span class="material-symbols-outlined text-gray-500 dark:text-gray-400">chair_alt</span>
                    <span class="font-medium text-sm">Armchair</span>
                </div>
                <span class="material-symbols-outlined text-primary">add</span>
            </li>
            <li class="item-button flex items-center justify-between gap-2 p-3 rounded-lg border border-gray-200 dark:border-gray-700 bg-background-light dark:bg-gray-800 cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors" data-item="coffee_table">
                <div class="flex items-center gap-3">
                    <span class="material-symbols-outlined text-gray-500 dark:text-gray-400">table_bar</span>
                    <span class="font-medium text-sm">Coffee Table</span>
                </div>
                <span class="material-symbols-outlined text-primary">add</span>
            </li>
            <li class="item-button flex items-center justify-between gap-2 p-3 rounded-lg border border-gray-200 dark:border-gray-700 bg-background-light dark:bg-gray-800 cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors" data-item="tv_stand">
                <div class="flex items-center gap-3">
                    <span class="material-symbols-outlined text-gray-500 dark:text-gray-400">tv</span>
                    <span class="font-medium text-sm">TV Stand</span>
                </div>
                <span class="material-symbols-outlined text-primary">add</span>
            </li>
        </ul>
    </div>
</div>

<!-- Bedroom Items Category -->
<div class="item-category">
    <div class="item-category-header" onclick="toggleCategory('bedroom-items')">
        <h3 class="text-lg font-bold text-gray-900 dark:text-white">Bedroom</h3>
        <span class="material-symbols-outlined transition-transform" id="bedroom-items-icon">expand_more</span>
    </div>
    <div class="item-category-content collapsed" id="bedroom-items">
        <ul class="space-y-2 mt-2">
            <li class="item-button flex items-center justify-between gap-2 p-3 rounded-lg border border-gray-200 dark:border-gray-700 bg-background-light dark:bg-gray-800 cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors" data-item="bed_queen">
                <div class="flex items-center gap-3">
                    <span class="material-symbols-outlined text-gray-500 dark:text-gray-400">bed</span>
                    <span class="font-medium text-sm">Queen Bed</span>
                </div>
                <span class="material-symbols-outlined text-primary">add</span>
            </li>
            <li class="item-button flex items-center justify-between gap-2 p-3 rounded-lg border border-gray-200 dark:border-gray-700 bg-background-light dark:bg-gray-800 cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors" data-item="bed_single">
                <div class="flex items-center gap-3">
                    <span class="material-symbols-outlined text-gray-500 dark:text-gray-400">single_bed</span>
                    <span class="font-medium text-sm">Single Bed</span>
                </div>
                <span class="material-symbols-outlined text-primary">add</span>
            </li>
            <li class="item-button flex items-center justify-between gap-2 p-3 rounded-lg border border-gray-200 dark:border-gray-700 bg-background-light dark:bg-gray-800 cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors" data-item="wardrobe">
                <div class="flex items-center gap-3">
                    <span class="material-symbols-outlined text-gray-500 dark:text-gray-400">door_sliding</span>
                    <span class="font-medium text-sm">Wardrobe</span>
                </div>
                <span class="material-symbols-outlined text-primary">add</span>
            </li>
            <li class="item-button flex items-center justify-between gap-2 p-3 rounded-lg border border-gray-200 dark:border-gray-700 bg-background-light dark:bg-gray-800 cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors" data-item="nightstand">
                <div class="flex items-center gap-3">
                    <span class="material-symbols-outlined text-gray-500 dark:text-gray-400">inventory_2</span>
                    <span class="font-medium text-sm">Nightstand</span>
                </div>
                <span class="material-symbols-outlined text-primary">add</span>
            </li>
        </ul>
    </div>
</div>

<!-- Office Items Category -->
<div class="item-category">
    <div class="item-category-header" onclick="toggleCategory('office-items')">
        <h3 class="text-lg font-bold text-gray-900 dark:text-white">Office</h3>
        <span class="material-symbols-outlined transition-transform" id="office-items-icon">expand_more</span>
    </div>
    <div class="item-category-content collapsed" id="office-items">
        <ul class="space-y-2 mt-2">
             <li class="item-button flex items-center justify-between gap-2 p-3 rounded-lg border border-gray-200 dark:border-gray-700 bg-background-light dark:bg-gray-800 cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors" data-item="desk">
                <div class="flex items-center gap-3">
                    <span class="material-symbols-outlined text-gray-500 dark:text-gray-400">desk</span>
                    <span class="font-medium text-sm">Desk</span>
                </div>
                <span class="material-symbols-outlined text-primary">add</span>
            </li>
            <li class="item-button flex items-center justify-between gap-2 p-3 rounded-lg border border-gray-200 dark:border-gray-700 bg-background-light dark:bg-gray-800 cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors" data-item="office_chair">
                <div class="flex items-center gap-3">
                    <span class="material-symbols-outlined text-gray-500 dark:text-gray-400">chair</span>
                    <span class="font-medium text-sm">Office Chair</span>
                </div>
                <span class="material-symbols-outlined text-primary">add</span>
            </li>
            <li class="item-button flex items-center justify-between gap-2 p-3 rounded-lg border border-gray-200 dark:border-gray-700 bg-background-light dark:bg-gray-800 cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors" data-item="bookshelf">
                <div class="flex items-center gap-3">
                    <span class="material-symbols-outlined text-gray-500 dark:text-gray-400">shelves</span>
                    <span class="font-medium text-sm">Bookshelf</span>
                </div>
                <span class="material-symbols-outlined text-primary">add</span>
            </li>
        </ul>
    </div>
</div>

<!-- Dining Room Items Category -->
<div class="item-category">
    <div class="item-category-header" onclick="toggleCategory('dining-items')">
        <h3 class="text-lg font-bold text-gray-900 dark:text-white">Dining Room</h3>
        <span class="material-symbols-outlined transition-transform" id="dining-items-icon">expand_more</span>
    </div>
    <div class="item-category-content collapsed" id="dining-items">
        <ul class="space-y-2 mt-2">
            <li class="item-button flex items-center justify-between gap-2 p-3 rounded-lg border border-gray-200 dark:border-gray-700 bg-background-light dark:bg-gray-800 cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors" data-item="dining_table">
                <div class="flex items-center gap-3">
                    <span class="material-symbols-outlined text-gray-500 dark:text-gray-400">table_restaurant</span>
                    <span class="font-medium text-sm">Dining Table</span>
                </div>
                <span class="material-symbols-outlined text-primary">add</span>
            </li>
            <li class="item-button flex items-center justify-between gap-2 p-3 rounded-lg border border-gray-200 dark:border-gray-700 bg-background-light dark:bg-gray-800 cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors" data-item="dining_chair">
                <div class="flex items-center gap-3">
                    <span class="material-symbols-outlined text-gray-500 dark:text-gray-400">chair</span>
                    <span class="font-medium text-sm">Dining Chair</span>
                </div>
                <span class="material-symbols-outlined text-primary">add</span>
            </li>
            <li class="item-button flex items-center justify-between gap-2 p-3 rounded-lg border border-gray-200 dark:border-gray-700 bg-background-light dark:bg-gray-800 cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors" data-item="sideboard">
                <div class="flex items-center gap-3">
                    <span class="material-symbols-outlined text-gray-500 dark:text-gray-400">countertops</span>
                    <span class="font-medium text-sm">Sideboard</span>
                </div>
                <span class="material-symbols-outlined text-primary">add</span>
            </li>
        </ul>
    </div>
</div>

<!-- Decor Items Category -->
<div class="item-category">
    <div class="item-category-header" onclick="toggleCategory('decor-items')">
        <h3 class="text-lg font-bold text-gray-900 dark:text-white">Decor & Lighting</h3>
        <span class="material-symbols-outlined transition-transform" id="decor-items-icon">expand_more</span>
    </div>
    <div class="item-category-content collapsed" id="decor-items">
        <ul class="space-y-2 mt-2">
            <li class="item-button flex items-center justify-between gap-2 p-3 rounded-lg border border-gray-200 dark:border-gray-700 bg-background-light dark:bg-gray-800 cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors" data-item="rug_large">
                <div class="flex items-center gap-3">
                    <span class="material-symbols-outlined text-gray-500 dark:text-gray-400">texture</span>
                    <span class="font-medium text-sm">Large Rug</span>
                </div>
                <span class="material-symbols-outlined text-primary">add</span>
            </li>
            <li class="item-button flex items-center justify-between gap-2 p-3 rounded-lg border border-gray-200 dark:border-gray-700 bg-background-light dark:bg-gray-800 cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors" data-item="floor_lamp">
                <div class="flex items-center gap-3">
                    <span class="material-symbols-outlined text-gray-500 dark:text-gray-400">wb_iridescent</span>
                    <span class="font-medium text-sm">Floor Lamp</span>
                </div>
                <span class="material-symbols-outlined text-primary">add</span>
            </li>
            <li class="item-button flex items-center justify-between gap-2 p-3 rounded-lg border border-gray-200 dark:border-gray-700 bg-background-light dark:bg-gray-800 cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors" data-item="potted_plant">
                <div class="flex items-center gap-3">
                    <span class="material-symbols-outlined text-gray-500 dark:text-gray-400">potted_plant</span>
                    <span class="font-medium text-sm">Plant</span>
                </div>
                <span class="material-symbols-outlined text-primary">add</span>
            </li>
            <li class="item-button flex items-center justify-between gap-2 p-3 rounded-lg border border-gray-200 dark:border-gray-700 bg-background-light dark:bg-gray-800 cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors" data-item="painting">
                <div class="flex items-center gap-3">
                    <span class="material-symbols-outlined text-gray-500 dark:text-gray-400">image</span>
                    <span class="font-medium text-sm">Wall Painting</span>
                </div>
                <span class="material-symbols-outlined text-primary">add</span>
            </li>
        </ul>
    </div>
</div>

<!-- Outdoor Items Category -->
<div class="item-category">
    <div class="item-category-header" onclick="toggleCategory('outdoor-items')">
        <h3 class="text-lg font-bold text-gray-900 dark:text-white">Outdoor</h3>
        <span class="material-symbols-outlined transition-transform" id="outdoor-items-icon">expand_more</span>
    </div>
    <div class="item-category-content collapsed" id="outdoor-items">
        <ul class="space-y-2 mt-2">
            <li class="item-button flex items-center justify-between gap-2 p-3 rounded-lg border border-gray-200 dark:border-gray-700 bg-background-light dark:bg-gray-800 cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors" data-item="patio_table">
                <div class="flex items-center gap-3">
                    <span class="material-symbols-outlined text-gray-500 dark:text-gray-400">deck</span>
                    <span class="font-medium text-sm">Patio Table</span>
                </div>
                <span class="material-symbols-outlined text-primary">add</span>
            </li>
            <li class="item-button flex items-center justify-between gap-2 p-3 rounded-lg border border-gray-200 dark:border-gray-700 bg-background-light dark:bg-gray-800 cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors" data-item="patio_chair">
                <div class="flex items-center gap-3">
                    <span class="material-symbols-outlined text-gray-500 dark:text-gray-400">chair_alt</span>
                    <span class="font-medium text-sm">Patio Chair</span>
                </div>
                <span class="material-symbols-outlined text-primary">add</span>
            </li>
            <li class="item-button flex items-center justify-between gap-2 p-3 rounded-lg border border-gray-200 dark:border-gray-700 bg-background-light dark:bg-gray-800 cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors" data-item="lounger">
                <div class="flex items-center gap-3">
                    <span class="material-symbols-outlined text-gray-500 dark:text-gray-400">beach_access</span>
                    <span class="font-medium text-sm">Lounger</span>
                </div>
                <span class="material-symbols-outlined text-primary">add</span>
            </li>
        </ul>
    </div>
</div>

<div class="mt-auto">
<button id="delete-button" class="w-full flex min-w-[84px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-10 px-4 bg-red-500/20 text-red-500 dark:bg-red-500/30 text-sm font-bold tracking-[0.015em] hover:bg-red-500/30 dark:hover:bg-red-500/40 transition-colors gap-2">
<span class="material-symbols-outlined text-base">delete</span>
<span class="truncate">Delete Mode</span>
</button>
</div>
</aside>
<div class="flex-1 relative bg-gray-100 dark:bg-gray-900">
<div id="viewport-container">
<div id="blueprint-view">
<canvas id="blueprint-canvas"></canvas>
</div>
<div id="panorama-3d-view">
<canvas id="cv"></canvas>
<div id="render-3d-view"></div>
</div>
</div>
</div>
<aside class="w-72 flex-shrink-0 border-l border-gray-200 dark:border-gray-800 bg-white dark:bg-background-dark/50 p-4 flex flex-col gap-6 overflow-y-auto">
<h3 class="text-lg font-bold text-gray-900 dark:text-white">Customize Selection</h3>
<div>
<div class="flex items-center justify-between mb-2">
    <h4 class="text-sm font-semibold text-gray-600 dark:text-gray-400">Textures</h4>
    <div class="flex bg-gray-200 dark:bg-gray-700 rounded-md p-0.5">
        <button id="target-wall" class="px-2 py-0.5 text-xs font-medium rounded-sm bg-white dark:bg-gray-600 text-gray-800 dark:text-gray-200 shadow-sm transition-all">Walls</button>
        <button id="target-floor" class="px-2 py-0.5 text-xs font-medium rounded-sm text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200 transition-all">Floor</button>
    </div>
</div>
<div class="grid grid-cols-3 gap-2">
<button class="texture-button aspect-square rounded-md bg-gray-200 border border-transparent hover:border-primary transition-colors" data-texture="marble" title="Marble texture">
<span class="text-xs">Marble</span>
</button>
<button class="texture-button aspect-square rounded-md bg-amber-100 border border-transparent hover:border-primary transition-colors" data-texture="wood" title="Wood texture">
<span class="text-xs">Wood</span>
</button>
<button class="texture-button aspect-square rounded-md bg-blue-100 border border-transparent hover:border-primary transition-colors" data-texture="tile" title="Ceramic tile texture">
<span class="text-xs">Tile</span>
</button>
<button class="texture-button aspect-square rounded-md bg-gray-400 border border-transparent hover:border-primary transition-colors" data-texture="concrete" title="Concrete texture">
<span class="text-xs">Concrete</span>
</button>
<button class="texture-button aspect-square rounded-md bg-stone-300 border border-transparent hover:border-primary transition-colors" data-texture="stone" title="Stone texture">
<span class="text-xs">Stone</span>
</button>
<button class="texture-button aspect-square rounded-md bg-green-200 border border-transparent hover:border-primary transition-colors" data-texture="carpet" title="Carpet texture">
<span class="text-xs">Carpet</span>
</button>
</div>
</div>

<div class="mt-4 border-t border-gray-200 dark:border-gray-700 pt-4">
    <h4 class="text-sm font-semibold mb-2 text-gray-600 dark:text-gray-400">Custom Maps</h4>
    <div class="space-y-3">
        <div>
            <label class="block text-xs text-gray-500 mb-1">Diffuse / Color</label>
            <input type="file" id="custom-diffuse" accept="image/*" class="block w-full text-xs text-gray-500 file:mr-2 file:py-1 file:px-2 file:rounded-md file:border-0 file:text-xs file:font-semibold file:bg-primary/10 file:text-primary hover:file:bg-primary/20">
        </div>
        <div>
            <label class="block text-xs text-gray-500 mb-1">Normal Map</label>
            <input type="file" id="custom-normal" accept="image/*" class="block w-full text-xs text-gray-500 file:mr-2 file:py-1 file:px-2 file:rounded-md file:border-0 file:text-xs file:font-semibold file:bg-primary/10 file:text-primary hover:file:bg-primary/20">
        </div>
        <div>
            <label class="block text-xs text-gray-500 mb-1">Roughness Map</label>
            <input type="file" id="custom-roughness" accept="image/*" class="block w-full text-xs text-gray-500 file:mr-2 file:py-1 file:px-2 file:rounded-md file:border-0 file:text-xs file:font-semibold file:bg-primary/10 file:text-primary hover:file:bg-primary/20">
        </div>
    </div>
</div>

<div>
<h4 class="text-sm font-semibold mb-2 text-gray-600 dark:text-gray-400">Materials</h4>
<div class="grid grid-cols-3 gap-2">
<button class="material-button aspect-square rounded-md bg-gray-300 border border-transparent hover:border-primary flex items-center justify-center text-xs font-bold text-gray-600 transition-colors" data-material="matte">Matte</button>
<button class="material-button aspect-square rounded-md bg-gray-100 border-2 border-primary flex items-center justify-center text-xs font-bold text-gray-800 transition-colors" data-material="gloss" style="background-image: linear-gradient(45deg, #e0e0e0, #ffffff, #e0e0e0);">Gloss</button>
<button class="material-button aspect-square rounded-md bg-gray-400 border border-transparent hover:border-primary flex items-center justify-center text-xs font-bold text-white transition-colors" data-material="metal" style="background-image: linear-gradient(45deg, #a0a0a0, #d0d0d0, #a0a0a0);">Metal</button>
</div>
</div>
<div>
<h4 class="text-sm font-semibold mb-2 text-gray-600 dark:text-gray-400">Colors</h4>
<div class="grid grid-cols-5 gap-2">
<button class="color-button aspect-square rounded-full bg-white border-2 border-primary" data-color="#ffffff" aria-label="White" title="White"></button>
<button class="color-button aspect-square rounded-full bg-gray-200 border border-transparent hover:border-primary transition-colors" data-color="#e5e7eb" aria-label="Light Gray" title="Light Gray"></button>
<button class="color-button aspect-square rounded-full bg-gray-800 border border-transparent hover:border-primary transition-colors" data-color="#1f2937" aria-label="Charcoal" title="Charcoal"></button>
<button class="color-button aspect-square rounded-full bg-blue-200 border border-transparent hover:border-primary transition-colors" data-color="#bfdbfe" aria-label="Light Blue" title="Light Blue"></button>
<button class="color-button aspect-square rounded-full border border-transparent hover:border-primary transition-colors" data-color="#f5f5dc" aria-label="Beige" title="Beige" style="background-color: #f5f5dc;"></button>
<button class="color-button aspect-square rounded-full bg-slate-400 border border-transparent hover:border-primary transition-colors" data-color="#94a3b8" aria-label="Slate" title="Slate"></button>
<button class="color-button aspect-square rounded-full bg-teal-600 border border-transparent hover:border-primary transition-colors" data-color="#0d9488" aria-label="Teal" title="Teal"></button>
<button class="color-button aspect-square rounded-full bg-rose-300 border border-transparent hover:border-primary transition-colors" data-color="#fda4af" aria-label="Rose" title="Rose"></button>
<button class="color-button aspect-square rounded-full bg-amber-500 border border-transparent hover:border-primary transition-colors" data-color="#f59e0b" aria-label="Amber" title="Amber"></button>
<button class="color-button aspect-square rounded-full bg-emerald-500 border border-transparent hover:border-primary transition-colors" data-color="#10b981" aria-label="Emerald" title="Emerald"></button>
</div>
</div>
<div class="mt-4 p-3 bg-gray-100 dark:bg-gray-800 rounded-lg">
<p class="text-xs text-gray-600 dark:text-gray-400">
    <span class="material-symbols-outlined" style="font-size: 14px; vertical-align: middle;">info</span>
    Select an item on the blueprint to customize its appearance
</p>
</div>
</aside>
</main>
</div>

<div class="tooltip" id="tooltip"></div>
<div id="nipple-container" style="position: absolute; bottom: 20px; left: 20px; width: 150px; height: 150px; z-index: 100; display: none;"></div>
<div id="walk-instructions" style="position: absolute; top: 100px; left: 50%; transform: translateX(-50%); background: rgba(0,0,0,0.6); color: white; padding: 10px 20px; border-radius: 20px; pointer-events: none; display: none; z-index: 100;">
    WASD to Move • Mouse to Look • ESC to Exit
</div>

<script type="importmap">
{
  "imports": {
    "three": "https://esm.sh/three@0.160.0",
    "three/addons/": "https://esm.sh/three@0.160.0/examples/jsm/",
    "three/nodes": "https://esm.sh/three@0.160.0/examples/jsm/nodes/Nodes.js",
    "nipplejs": "https://esm.sh/nipplejs@0.10.1"
  }
}
</script>
<script type="module" src="main.js"></script>
<script>
// Category toggle
function toggleCategory(id) {
    const content = document.getElementById(id);
    const icon = document.getElementById(id + '-icon');
    content.classList.toggle('collapsed');
    icon.style.transform = content.classList.contains('collapsed') ? 'rotate(-90deg)' : 'rotate(0deg)';
}

// Tooltips
document.querySelectorAll('[title]').forEach(el => {
    el.addEventListener('mouseenter', (e) => {
        const tooltip = document.getElementById('tooltip');
        tooltip.textContent = el.getAttribute('title');
        tooltip.classList.add('active');
        const rect = el.getBoundingClientRect();
        tooltip.style.left = rect.left + 'px';
        tooltip.style.top = (rect.top - 35) + 'px';
    });
    
    el.addEventListener('mouseleave', () => {
        document.getElementById('tooltip').classList.remove('active');
    });
});
</script>
</body>






